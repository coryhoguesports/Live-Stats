<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>CoryHogueSports Live Game Stats</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: light; }
    body{ margin:0; background:#fff; font:500 16px/1.35 system-ui, Arial; color:#000; }
    h1{ text-align:center; font-weight:600; margin:14px 0; }
    .wrap{ max-width:1100px; margin:0 auto 18px; padding:0 12px; }
    .grid{ display:grid; grid-template-columns:1fr 1fr; gap:22px; }
    table{ width:100%; border-collapse:collapse; background:#fff; }
    th,td{ border:1px solid #000; padding:6px 8px; vertical-align:top; }
    .center{ text-align:center; }
    .meta{ display:grid; grid-template-columns:1fr auto 1fr; align-items:end; gap:14px; margin:6px 0 10px; }
    .meta .box{ text-align:center; }
    .note{ text-align:center; font-weight:600; margin:10px 0 6px; }
    /* tweak for small screens */
    @media (max-width:900px){ .grid{ grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <h1>üèà CoryHogueSports Live Game Stats</h1>
  <div class="wrap">
    <div class="meta">
      <div class="box" id="leftTeam"></div>
      <div class="box" id="clockRow"></div>
      <div class="box" id="rightTeam"></div>
    </div>

    <div class="note" id="headline"></div>

    <!-- ‚úÖ PLACE #1: status line goes right under the headline -->
    <div id="status" class="center" style="margin:6px 0 16px; font-size:13px; opacity:.7"></div>

    <div class="grid">
      <div>
        <table id="leftTeamStats"></table>
        <br/>
        <table id="leftIndivRush"></table>
        <br/>
        <table id="leftIndivPass"></table>
      </div>
      <div>
        <table id="rightTeamStats"></table>
        <br/>
        <table id="rightIndivRush"></table>
        <br/>
        <table id="rightIndivPass"></table>
      </div>
    </div>
  </div>

  <!-- ‚úÖ PLACE #2: replace your whole script with this one -->
  <script>
    const WEBAPP_JSON = "https://script.google.com/macros/s/AKfycbyml0Pv99NXqzMBSUOp5CF3MOiDnzu5U7oJEbG9_2fOgiqD2IiX5-HUOp11TiPsl2EtGA/exec";

    function drawTable(el, rows){
      el.innerHTML = rows.map(r => "<tr>"+ r.map(c => `<td>${(c ?? "").toString().replace(/</g,"&lt;")}</td>`).join("") +"</tr>").join("");
      if (rows.length) {
        const first = el.querySelector("tr");
        if (first) first.outerHTML = first.outerHTML.replaceAll("<td>","<th>").replaceAll("</td>","</th>");
      }
    }

    const els = {
      leftTeam: document.getElementById("leftTeam"),
      clockRow: document.getElementById("clockRow"),
      rightTeam: document.getElementById("rightTeam"),
      headline: document.getElementById("headline"),
      leftTeamStats: document.getElementById("leftTeamStats"),
      rightTeamStats: document.getElementById("rightTeamStats"),
      leftIndivRush: document.getElementById("leftIndivRush"),
      rightIndivRush: document.getElementById("rightIndivRush"),
      leftIndivPass: document.getElementById("leftIndivPass"),
      rightIndivPass: document.getElementById("rightIndivPass"),
      status: document.getElementById("status")
    };

    let lastGoodData = null;
    let lastUpdateTs = 0;

    function render(data){
      // Adjust these indices to your sheet layout as needed
      els.leftTeam.textContent  = (data[0]?.[0] ?? "");
      els.clockRow.innerHTML    = `Time<br><span style="font-weight:700">${data[1]?.[2] ?? ""}</span>`;
      els.rightTeam.textContent = (data[0]?.[6] ?? "");

      els.headline.textContent = (data[6]?.[0] ?? "");

      drawTable(els.leftTeamStats,  data.slice(8,17).map(r => [r[0], r[1]]));
      drawTable(els.rightTeamStats, data.slice(8,17).map(r => [r[6], r[7]]));

      drawTable(els.leftIndivRush,
        [ ["Individual Rushing","Att","Yds","TD"], ...data.slice(19,23).map(r => [r[0], r[1], r[2], r[3]]) ]);

      drawTable(els.rightIndivRush,
        [ ["Individual Rushing","Att","Yds","TD"], ...data.slice(19,24).map(r => [r[6], r[7], r[8], r[9]]) ]);

      drawTable(els.leftIndivPass,
        [ ["Individual Passing","Comp","Att","Int","Yds","TD"], ...data.slice(26,27).map(r => [r[0], r[1], r[2], r[3], r[4], r[5]]) ]);

      drawTable(els.rightIndivPass,
        [ ["Individual Passing","Comp","Att","Int","Yds","TD"], ...data.slice(26,28).map(r => [r[6], r[7], r[8], r[9], r[10], r[11]]) ]);

      els.status.textContent = `Live ‚Äî updated ${new Date().toLocaleTimeString()}`;
    }

    async function load() {
      try {
        const res = await fetch(WEBAPP_JSON + "?v=" + Date.now(), { cache: "no-store" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const { data } = await res.json();
        lastGoodData = data;
        lastUpdateTs = Date.now();
        render(data);
      } catch (e) {
        if (lastGoodData) {
          els.status.textContent = `Reconnecting‚Ä¶ last update ${new Date(lastUpdateTs).toLocaleTimeString()}`;
        } else {
          els.status.textContent = `Connecting‚Ä¶`;
        }
        console.warn("Fetch failed:", e);
      }
    }

    load();
    setInterval(load, 5000);
  </script>
</body>
</html>
